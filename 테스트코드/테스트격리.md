유스콘 마지막 과제를 진행하고 나서 제이슨님이 아래와 같은 질문을 주셨다.

> 인수테스트를 작성하셨는데 테스트 격리를 매번 테스트를 수행하고 초기화를 해주는 작업을 하신 것 같다. 선택하신 방법 외에 어떤 방법이 있는지?

나는 @Transactional 어노테이션을 쓰면 될 것 같다고 하였고 추가로 테스트 메서드에 어노테이션을 붙여주면 정상적으로 동작할 것 같냐는 질문에 동작할 것 같다고 하였고 발생할 수 있는 문제로는 실제로 데이터의 변경이 일어나는 서비스 로직에 @Transactional 어노테이션을 붙이지 않고 테스트에만 붙이는 경우 테스트는 통과하는데 실제로 해당 로직에서 에러가 발생할 수도 있을 것 같다고 하였다.

과연 정상적으로 동작하였을까? 한번 알아보도록 하겠다.

# 테스트 격리
인수테스트를 작성하다 보면 각각의 테스트는 잘 동작하지만 한번에 테스트하는 경우 실패할 수 있다. 이유는 각각의 테스트가 자원을 공유하여서 생성, 수정, 삭제를 테스트하여 발생한 변화 떄문에 조회에서 원하는바와 다르게 조회가 될 수 있는데 테스트를 격리하여 이를 해결할 수 있다.

## 1. Truncate table
Truncate는 테이블 내부의 모든 행을 삭제한다. 따라서 매 테스트마다 Truncate table을 통해 데이터의 상태를 초기화 하여 각각의 테스트마다 동일한 테이블 상태를 유지할 수 있다.

- @sql 어노테이션 사용

사진 2장 추가+ sql 사진 추가


엔티티가 추가될때마다 sql파일을 수정해줘야하지만 테스트에 따라 필요한 테이블들만 초기화하는 장점도 있을 것 같다.

- EntityManager 사용
스프링에서 제공하는 InitializingBean를 구현하여 afterPropertiesSet메소드를 통해 빈 객체 초기화 시 엔티티 매니저를 통해 테이블의 이름을 가져와서 초기화하는 방법







